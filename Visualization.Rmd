---
title: "Visualization"
output: github_document
---

#Visualization: Part I

```{r setup}
library(tidyverse)
library(ggridges)
```

## Load the weather data
```{r}
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728", "USC00519397", "USS0023B17S"),
    var = c("PRCP", "TMIN", "TMAX"),
    date_min = "2017-01-01",
    date_max = "2017-12-31") %>%
  mutate(
    name = recode(
      id,
      USW00094728 = "CentralPark_NY",
      USC00519397 = "Waikiki_HA",
      USS0023B17S = "Waterhole_WA"),
    tmin = tmin/10,
    tmax = tmax/10) %>%
  select(name, id, everything())
```
```{r}
library(p8105.datasets)
data("weather_df")

view(weather_df)
```



## Scatterplots!!
create my first scatterplot ever.
```{r}
ggplot(weather_df, aes(x = tmin, y = tmax)) +
  geom_point()
```

New approach, same plot. 
```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = tmax)) +
  geom_point()
```
Save and edit a plot object

```{r}
weather_plot = 
  weather_df %>%
  ggplot(aes(x = tmin, y = tmax))

weather_plot + geom_point()
```
## Advanced scatterplot ...

start with the same one and make it fancy !

```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = tmax, color = name)) +
  geom_point() +
  geom_smooth(se = FALSE)
```



What about the 'aes' placement --?

```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = tmax)) +
  geom_point(color = name) +
  geom_smooth()
```

Let's facet same things!

```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = tmax, name = color)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  facet_grid(. ~ name)
```

```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = tmax, name = color)) +
  geom_point(alpha = .2, size = .3) +
  geom_smooth(se = FALSE, size = 2) +
  facet_grid(. ~ name)
```

```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = tmax, alpha = tmin, name = color)) +
  geom_point(size = .3) +
  geom_smooth(se = FALSE, size = 2) +
  facet_grid(. ~ name)
```

let's combine some elements and try a new plot

```{r}
weather_df %>%
  ggplot(aes(x = date, y = tmax, color = name)) +
  geom_point(aes(size = prcp), alpha = .5)
  geom_smooth(se = FALSE) +
  facet_grid(. ~ name)
```
## Some small notes
How many geoms have to exist?
You can have whater geoms you want.

```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = tmax, color = name)) +
  geom_smooth(se = FALSE)
```

You can use a neat geom!

```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = tmax)) +
  geom_hex()
```

```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = tmax)) +
  geom_bin2d()
```

```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = tmax)) +
  geom_density2d() +
  geom_point(alpha = .3)
```

## Univariate plots

Histograms are really great.
```{r}
weather_df %>%
  ggplot(aes(x = tmin)) + 
  geom_histogram()
```

Can we add color ---
```{r}
weather_df %>%
  ggplot(aes(x = tmin, color = name)) + 
  geom_histogram(position =  "dodge")
```

```{r}
weather_df %>%
  ggplot(aes(x = tmin, fill = name)) + 
  geom_histogram(position =  "dodge")
```

```{r}
weather_df %>%
  ggplot(aes(x = tmin, fill = name)) + 
  geom_histogram() + 
  facet_grid(. ~name)
```

Let's try a new geometry!

```{r}
weather_df %>%
  ggplot(aes(x = tmin, fill = name)) +
  geom_density(alpha = .3)
```

What about box plots??

```{r}
weather_df %>%
  ggplot(aes(x = name, y = tmin)) +
  geom_boxplot()
```

Trendy plots :-)

```{r}
weather_df %>%
  ggplot(aes(x = name, y = tmin, fill = name)) +
  geom_violin() +
  stat_summary(fun = "median")
```

Ridge plot -- the most popular plot of 2017
```{r}
weather_df %>%
  ggplot(aes(x = tmin, y = name)) +
  geom_density_ridges()
```

## Save ad Embed

Let's save a scatterplot.

```{r}
weather_plot = 
  weather_df %>%
  ggplot(aes(x = tmin, y = tmax, color = name)) +
  geom_point(alphar = .5)

ggsave("weather_plot.pdf", weather_plot, width = 8, height = 5)
ggsave("./results/weather_plot.pdf", weather_plot, width = 8, height = 5)

```

What about embedding...
```{r, fig.width=6, fig.height=6}
weather_plot

```

Embed at different size
```{r, fig.width=12, fig.height=6}
weather_plot
```

### Learning Assessment I

```{r}
weather_df %>%
  filter(name == "CentralPark_NY") %>%
  mutate(
    tmax_fahr = tmax * (9 / 5) + 32,
    tmin_fahr = tmin * (9 / 5) + 32) %>%
  ggplot(aes(x = tmin_fahr, y = tmax_fahr)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "1m", se = FALSE)
```

### Learning Assessment II
Learning Assessment: Make plots that compare precipitation across locations. Try a histogram, a density plot, a boxplot, a violin plot, and a ridgeplot; use aesthetic mappings to make your figure readable.

 Solution
I’ll show a few possibilities, although this is by no means exhaustive!

First a density plot:

ggplot(weather_df, aes(x = prcp)) + 
  geom_density(aes(fill = name), alpha = .5) 
Next a ridge plot:

ggplot(weather_df, aes(x = prcp, y = name)) + 
  geom_density_ridges(scale = .85)
Last a boxplot:

ggplot(weather_df, aes(y = prcp, x = name)) + 
  geom_boxplot() 
This is a tough variable to plot because of the highly skewed distribution in each location. Of these, I’d probably choose the boxplot because it shows the outliers most clearly. If the “bulk” of the data were interesting, I’d probably compliment this with a plot showing data for all precipitation less than 100, or for a data omitting days with no precipitation.

weather_df |> 
  filter(prcp > 0) |> 
  ggplot(aes(x = prcp, y = name)) + 
  geom_density_ridges(scale = .85)










